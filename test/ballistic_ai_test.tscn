[gd_scene load_steps=6 format=3 uid="uid://btpycjnfryp5p"]

[ext_resource type="Script" path="res://test/grid.gd" id="1_yysna"]
[ext_resource type="Texture2D" uid="uid://bude4na0hnosm" path="res://icon.svg" id="2_krx02"]
[ext_resource type="Script" path="res://classes/BallisticAI.gd" id="3_v44xm"]

[sub_resource type="GDScript" id="GDScript_l4cjt"]
script/source = "extends Node2D

var velocity:Vector2

# Called when the node enters the scene tree for the first time.
func _ready() -> void:
	pass # Replace with function body.


# Called every frame. 'delta' is the elapsed time since the previous frame.
func _physics_process(delta: float) -> void:
	var to_target:Vector2 = get_global_mouse_position() - global_position
	velocity = to_target
	global_position += velocity * delta
"

[sub_resource type="GDScript" id="GDScript_t1mk0"]
script/source = "extends Node2D

var linear_velocity:Vector2
var angular_velocity:float

func _ready()->void:
	if($'../Actor'!=self):
		remove_child($BallisticAI)
		var newai:BallisticAI = $'../Actor/BallisticAI'.duplicate()
		add_child(newai)
	$BallisticAI.pre_update.connect(_pre_update)
	$BallisticAI.post_update.connect(_post_update)

func _pre_update()->void:
	$BallisticAI.linear_velocity = linear_velocity
	$BallisticAI.angular_velocity = angular_velocity
	$BallisticAI.target_position = $'../Target'.global_position
	$BallisticAI.target_velocity = $'../Target'.velocity

func _post_update()->void:
	linear_velocity += $BallisticAI.force * get_physics_process_delta_time()
	angular_velocity += $BallisticAI.torque * get_physics_process_delta_time()
	
	global_position += linear_velocity * get_physics_process_delta_time()
	global_rotation += angular_velocity * get_physics_process_delta_time()
"

[node name="BallisticAiTest" type="Node2D"]

[node name="Grid" type="Node2D" parent="."]
script = ExtResource("1_yysna")
color = Color(0.458405, 0.458405, 0.458405, 1)
thickness = 1.0
separation = 128.0

[node name="Target" type="Node2D" parent="."]
script = SubResource("GDScript_l4cjt")

[node name="Sprite2D" type="Sprite2D" parent="Target"]
scale = Vector2(0.25, 0.25)
texture = ExtResource("2_krx02")

[node name="Camera2D" type="Camera2D" parent="Target"]
process_callback = 0

[node name="Actor" type="Node2D" parent="."]
position = Vector2(233, 223)
script = SubResource("GDScript_t1mk0")

[node name="Polygon2D" type="Polygon2D" parent="Actor"]
color = Color(1, 0.67451, 0.329412, 1)
polygon = PackedVector2Array(-12, 8, 0, -12, 12, 8)

[node name="BallisticAI" type="Node2D" parent="Actor"]
script = ExtResource("3_v44xm")
debug_draw = true
avoidance_max_neighbors = 100
avoidance_time_horizon_obstacles = 100.0

[node name="Actor2" type="Node2D" parent="."]
position = Vector2(400, -163)
script = SubResource("GDScript_t1mk0")

[node name="Polygon2D" type="Polygon2D" parent="Actor2"]
color = Color(1, 0.67451, 0.329412, 1)
polygon = PackedVector2Array(-12, 8, 0, -12, 12, 8)

[node name="BallisticAI" type="Node2D" parent="Actor2"]
script = ExtResource("3_v44xm")
debug_draw = true

[node name="Actor3" type="Node2D" parent="."]
position = Vector2(760, 39)
script = SubResource("GDScript_t1mk0")

[node name="Polygon2D" type="Polygon2D" parent="Actor3"]
color = Color(1, 0.67451, 0.329412, 1)
polygon = PackedVector2Array(-12, 8, 0, -12, 12, 8)

[node name="BallisticAI" type="Node2D" parent="Actor3"]
script = ExtResource("3_v44xm")
debug_draw = true

[node name="Actor4" type="Node2D" parent="."]
position = Vector2(198, -32)
script = SubResource("GDScript_t1mk0")

[node name="Polygon2D" type="Polygon2D" parent="Actor4"]
color = Color(1, 0.67451, 0.329412, 1)
polygon = PackedVector2Array(-12, 8, 0, -12, 12, 8)

[node name="BallisticAI" type="Node2D" parent="Actor4"]
script = ExtResource("3_v44xm")
debug_draw = true

[node name="Actor5" type="Node2D" parent="."]
position = Vector2(509, 275)
script = SubResource("GDScript_t1mk0")

[node name="Polygon2D" type="Polygon2D" parent="Actor5"]
color = Color(1, 0.67451, 0.329412, 1)
polygon = PackedVector2Array(-12, 8, 0, -12, 12, 8)

[node name="BallisticAI" type="Node2D" parent="Actor5"]
script = ExtResource("3_v44xm")
debug_draw = true

[node name="Actor6" type="Node2D" parent="."]
position = Vector2(187, 479)
script = SubResource("GDScript_t1mk0")

[node name="Polygon2D" type="Polygon2D" parent="Actor6"]
color = Color(1, 0.67451, 0.329412, 1)
polygon = PackedVector2Array(-12, 8, 0, -12, 12, 8)

[node name="BallisticAI" type="Node2D" parent="Actor6"]
script = ExtResource("3_v44xm")
debug_draw = true

[node name="Actor7" type="Node2D" parent="."]
position = Vector2(-239, 175)
script = SubResource("GDScript_t1mk0")

[node name="Polygon2D" type="Polygon2D" parent="Actor7"]
color = Color(1, 0.67451, 0.329412, 1)
polygon = PackedVector2Array(-12, 8, 0, -12, 12, 8)

[node name="BallisticAI" type="Node2D" parent="Actor7"]
script = ExtResource("3_v44xm")
debug_draw = true

[node name="Actor8" type="Node2D" parent="."]
position = Vector2(-386, -164)
script = SubResource("GDScript_t1mk0")

[node name="Polygon2D" type="Polygon2D" parent="Actor8"]
color = Color(1, 0.67451, 0.329412, 1)
polygon = PackedVector2Array(-12, 8, 0, -12, 12, 8)

[node name="BallisticAI" type="Node2D" parent="Actor8"]
script = ExtResource("3_v44xm")
debug_draw = true

[node name="Actor9" type="Node2D" parent="."]
position = Vector2(-28, -281)
script = SubResource("GDScript_t1mk0")

[node name="Polygon2D" type="Polygon2D" parent="Actor9"]
color = Color(1, 0.67451, 0.329412, 1)
polygon = PackedVector2Array(-12, 8, 0, -12, 12, 8)

[node name="BallisticAI" type="Node2D" parent="Actor9"]
script = ExtResource("3_v44xm")
debug_draw = true

[node name="Actor10" type="Node2D" parent="."]
position = Vector2(322, -334)
script = SubResource("GDScript_t1mk0")

[node name="Polygon2D" type="Polygon2D" parent="Actor10"]
color = Color(1, 0.67451, 0.329412, 1)
polygon = PackedVector2Array(-12, 8, 0, -12, 12, 8)

[node name="BallisticAI" type="Node2D" parent="Actor10"]
script = ExtResource("3_v44xm")
debug_draw = true

[node name="Actor11" type="Node2D" parent="."]
position = Vector2(-237, -391)
script = SubResource("GDScript_t1mk0")

[node name="Polygon2D" type="Polygon2D" parent="Actor11"]
color = Color(1, 0.67451, 0.329412, 1)
polygon = PackedVector2Array(-12, 8, 0, -12, 12, 8)

[node name="BallisticAI" type="Node2D" parent="Actor11"]
script = ExtResource("3_v44xm")
debug_draw = true

[node name="Actor12" type="Node2D" parent="."]
position = Vector2(-122, -39)
script = SubResource("GDScript_t1mk0")

[node name="Polygon2D" type="Polygon2D" parent="Actor12"]
color = Color(1, 0.67451, 0.329412, 1)
polygon = PackedVector2Array(-12, 8, 0, -12, 12, 8)

[node name="BallisticAI" type="Node2D" parent="Actor12"]
script = ExtResource("3_v44xm")
debug_draw = true

[node name="Actor13" type="Node2D" parent="."]
position = Vector2(-206, 377)
script = SubResource("GDScript_t1mk0")

[node name="Polygon2D" type="Polygon2D" parent="Actor13"]
color = Color(1, 0.67451, 0.329412, 1)
polygon = PackedVector2Array(-12, 8, 0, -12, 12, 8)

[node name="BallisticAI" type="Node2D" parent="Actor13"]
script = ExtResource("3_v44xm")
debug_draw = true

[node name="Actor14" type="Node2D" parent="."]
position = Vector2(114, -417)
script = SubResource("GDScript_t1mk0")

[node name="Polygon2D" type="Polygon2D" parent="Actor14"]
color = Color(1, 0.67451, 0.329412, 1)
polygon = PackedVector2Array(-12, 8, 0, -12, 12, 8)

[node name="BallisticAI" type="Node2D" parent="Actor14"]
script = ExtResource("3_v44xm")
debug_draw = true

[node name="Actor15" type="Node2D" parent="."]
position = Vector2(603, -325)
script = SubResource("GDScript_t1mk0")

[node name="Polygon2D" type="Polygon2D" parent="Actor15"]
color = Color(1, 0.67451, 0.329412, 1)
polygon = PackedVector2Array(-12, 8, 0, -12, 12, 8)

[node name="BallisticAI" type="Node2D" parent="Actor15"]
script = ExtResource("3_v44xm")
debug_draw = true

[node name="Actor16" type="Node2D" parent="."]
position = Vector2(400, 62)
script = SubResource("GDScript_t1mk0")

[node name="Polygon2D" type="Polygon2D" parent="Actor16"]
color = Color(1, 0.67451, 0.329412, 1)
polygon = PackedVector2Array(-12, 8, 0, -12, 12, 8)

[node name="BallisticAI" type="Node2D" parent="Actor16"]
script = ExtResource("3_v44xm")
debug_draw = true

[node name="Actor17" type="Node2D" parent="."]
position = Vector2(-394, 141)
script = SubResource("GDScript_t1mk0")

[node name="Polygon2D" type="Polygon2D" parent="Actor17"]
color = Color(1, 0.67451, 0.329412, 1)
polygon = PackedVector2Array(-12, 8, 0, -12, 12, 8)

[node name="BallisticAI" type="Node2D" parent="Actor17"]
script = ExtResource("3_v44xm")
debug_draw = true

[node name="NavigationObstacle2D" type="NavigationObstacle2D" parent="."]
position = Vector2(1202, 794)
vertices = PackedVector2Array(-297, -274, 458, -185, 661, 278, 119, 396, -481, 352, -447, -25, -249, 7, -433, -204)

[node name="NavigationObstacle2D2" type="NavigationObstacle2D" parent="."]
position = Vector2(1622, 141)
radius = 146.56

[node name="NavigationObstacle2D3" type="NavigationObstacle2D" parent="."]
position = Vector2(1167, -749)
radius = 68.97

[node name="NavigationObstacle2D4" type="NavigationObstacle2D" parent="."]
position = Vector2(2027, -668)
radius = 68.97

[node name="NavigationObstacle2D5" type="NavigationObstacle2D" parent="."]
position = Vector2(2423, 803)
radius = 166.67
