[gd_scene load_steps=16 format=3 uid="uid://c5gp5de2oi4dt"]

[ext_resource type="Script" path="res://classes/Interpolator.gd" id="1_q6mkr"]
[ext_resource type="Texture2D" uid="uid://bude4na0hnosm" path="res://icon.svg" id="2_1x0lk"]

[sub_resource type="GDScript" id="GDScript_pdst4"]
script/source = "@tool
extends Node2D

@export var color:Color:
	set(to):
		color = to
		queue_redraw()
@export var thickness:float:
	set(to):
		thickness = to
		queue_redraw()
@export var separation:float:
	set(to):
		separation = to
		queue_redraw()

func _process(delta: float) -> void:
	queue_redraw()

func _draw() -> void:
	var rect:Rect2 = get_canvas_transform().affine_inverse() * get_viewport_rect()
	
	var left:float = floor((rect.position.x-thickness)/separation)*separation
	var right:float = ceil((rect.end.x+thickness)/separation)*separation
	var top:float = floor((rect.position.y-thickness)/separation)*separation
	var bottom:float = ceil((rect.end.y+thickness)/separation)*separation
	
	if(is_nan(left)||is_inf(left)||is_nan(right)||is_inf(right)||is_nan(top)||is_inf(top)||is_nan(bottom)||is_inf(bottom)):
		return
	if((right-left)/separation>100 || (bottom-top)/separation>100):
		return
	
	var x:float = left
	while(x<=right):
		draw_line(Vector2(x,top),Vector2(x,bottom),color,thickness)
		x+=separation
	var y:float = top
	while(y<=bottom):
		draw_line(Vector2(left,y),Vector2(right,y),color,thickness)
		y+=separation
"

[sub_resource type="GDScript" id="GDScript_rnyd4"]
script/source = "extends Actor


func _physics_process(_delta: float) -> void:
	linear_target = get_global_mouse_position()
	$TargetLine.points = [Vector2.ZERO, (linear_target - global_position).rotated(-global_rotation)]
	$VelocityLine.points = [Vector2.ZERO, linear_velocity.rotated(-global_rotation)]
	$ThrustLine.points = [Vector2.ZERO, linear_thrust.rotated(-global_rotation)]
"

[sub_resource type="RectangleShape2D" id="RectangleShape2D_njbur"]
size = Vector2(32, 32)

[sub_resource type="GDScript" id="GDScript_y6nsh"]
script/source = "extends Actor


func _physics_process(_delta: float) -> void:
	linear_target = get_global_mouse_position() - global_position
	$TargetLine.points = [Vector2.ZERO, linear_target.rotated(-global_rotation)]
	$VelocityLine.points = [Vector2.ZERO, linear_velocity.rotated(-global_rotation)]
	$ThrustLine.points = [Vector2.ZERO, linear_thrust.rotated(-global_rotation)]
"

[sub_resource type="GDScript" id="GDScript_r5t52"]
script/source = "extends Actor


func _physics_process(_delta: float) -> void:
	linear_target = Vector2.ZERO
	reference_acceleration = $'../TargetActor'.linear_acceleration
	reference_velocity = $'../TargetActor'.linear_velocity
	reference_position = $'../TargetActor'.global_position
	$TargetLine.points = [Vector2.ZERO, (reference_position - global_position).rotated(-global_rotation)]
	$VelocityLine.points = [Vector2.ZERO, linear_velocity.rotated(-global_rotation)]
	$ThrustLine.points = [Vector2.ZERO, linear_thrust.rotated(-global_rotation)]
"

[sub_resource type="CircleShape2D" id="CircleShape2D_1fkjg"]
radius = 64.0

[sub_resource type="Gradient" id="Gradient_fcuy7"]
offsets = PackedFloat32Array(0.97654, 1)
colors = PackedColorArray(1, 1, 1, 1, 1, 1, 1, 0)

[sub_resource type="GradientTexture2D" id="GradientTexture2D_4ct4i"]
gradient = SubResource("Gradient_fcuy7")
width = 128
height = 128
fill = 1
fill_from = Vector2(0.5, 0.5)
fill_to = Vector2(1, 0.5)

[sub_resource type="CircleShape2D" id="CircleShape2D_vsry6"]
radius = 128.0

[sub_resource type="GDScript" id="GDScript_pu3on"]
script/source = "extends Actor


func _integrate_forces(state: PhysicsDirectBodyState2D) -> void:
	linear_target = get_global_mouse_position() - global_position
	super(state)
	$TargetLine.points = [Vector2.ZERO, linear_target.rotated(-global_rotation)]
	$VelocityLine.points = [Vector2.ZERO, linear_velocity.rotated(-global_rotation)]
	$ThrustLine.points = [Vector2.ZERO, linear_thrust.rotated(-global_rotation)]
	
"

[sub_resource type="GDScript" id="GDScript_qu3b8"]
script/source = "extends ActorSubBody

func _integrate_forces(state: PhysicsDirectBodyState2D) -> void:
	super(state)
	
	$ThrustLine.points = [Vector2.ZERO, correction_impulse.rotated(-global_rotation)]
	$VelocityLine.points = [Vector2.ZERO, linear_velocity.rotated(-global_rotation)]
	$TargetLine.points = [Vector2.ZERO, global_transform.affine_inverse() * get_parent().global_position]
"

[sub_resource type="RectangleShape2D" id="RectangleShape2D_t7hum"]
size = Vector2(16, 16)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_y8lin"]
size = Vector2(16, 16)

[node name="ActorTest" type="Node"]

[node name="Grid" type="Node2D" parent="."]
script = SubResource("GDScript_pdst4")
color = Color(0.18359, 0.18359, 0.18359, 1)
thickness = 1.0
separation = 256.0

[node name="LinearPositionBrakeActor" type="RigidBody2D" parent="."]
process_mode = 4
visible = false
collision_layer = 0
script = SubResource("GDScript_rnyd4")
linear_control_mode = 3

[node name="Interpolator" type="Node2D" parent="LinearPositionBrakeActor"]
script = ExtResource("1_q6mkr")

[node name="Sprite2D" type="Sprite2D" parent="LinearPositionBrakeActor/Interpolator"]
scale = Vector2(0.25, 0.25)
texture = ExtResource("2_1x0lk")

[node name="CollisionShape2D" type="CollisionShape2D" parent="LinearPositionBrakeActor"]
shape = SubResource("RectangleShape2D_njbur")

[node name="ThrustLine" type="Line2D" parent="LinearPositionBrakeActor"]
points = PackedVector2Array(-3, -32, 125, -30)
width = 2.0
default_color = Color(1, 0.239216, 0.243137, 1)

[node name="VelocityLine" type="Line2D" parent="LinearPositionBrakeActor"]
points = PackedVector2Array(3, -76, 126, -67)
width = 2.0
default_color = Color(0.313726, 0.341176, 1, 1)

[node name="TargetLine" type="Line2D" parent="LinearPositionBrakeActor"]
points = PackedVector2Array(13, -118, 129, -106)
width = 2.0
default_color = Color(0.270588, 0.854902, 0.298039, 1)

[node name="LinearPositionNoBrakeActor" type="RigidBody2D" parent="."]
process_mode = 4
visible = false
collision_layer = 0
script = SubResource("GDScript_rnyd4")
linear_control_mode = 3
linear_brake = 0.0

[node name="Interpolator" type="Node2D" parent="LinearPositionNoBrakeActor"]
script = ExtResource("1_q6mkr")

[node name="Sprite2D" type="Sprite2D" parent="LinearPositionNoBrakeActor/Interpolator"]
scale = Vector2(0.25, 0.25)
texture = ExtResource("2_1x0lk")

[node name="CollisionShape2D" type="CollisionShape2D" parent="LinearPositionNoBrakeActor"]
shape = SubResource("RectangleShape2D_njbur")

[node name="ThrustLine" type="Line2D" parent="LinearPositionNoBrakeActor"]
points = PackedVector2Array(-3, -32, 125, -30)
width = 2.0
default_color = Color(1, 0.239216, 0.243137, 1)

[node name="VelocityLine" type="Line2D" parent="LinearPositionNoBrakeActor"]
points = PackedVector2Array(3, -76, 126, -67)
width = 2.0
default_color = Color(0.313726, 0.341176, 1, 1)

[node name="TargetLine" type="Line2D" parent="LinearPositionNoBrakeActor"]
points = PackedVector2Array(13, -118, 129, -106)
width = 2.0
default_color = Color(0.270588, 0.854902, 0.298039, 1)

[node name="TargetActor" type="RigidBody2D" parent="."]
process_mode = 4
visible = false
collision_layer = 0
script = SubResource("GDScript_y6nsh")
linear_control_mode = 2

[node name="Interpolator" type="Node2D" parent="TargetActor"]
script = ExtResource("1_q6mkr")

[node name="Sprite2D" type="Sprite2D" parent="TargetActor/Interpolator"]
scale = Vector2(0.25, 0.25)
texture = ExtResource("2_1x0lk")

[node name="RemoteTransform2D" type="RemoteTransform2D" parent="TargetActor/Interpolator"]
remote_path = NodePath("../../../Camera2D")
update_rotation = false
update_scale = false

[node name="CollisionShape2D" type="CollisionShape2D" parent="TargetActor"]
shape = SubResource("RectangleShape2D_njbur")

[node name="ThrustLine" type="Line2D" parent="TargetActor"]
points = PackedVector2Array(-3, -32, 125, -30)
width = 2.0
default_color = Color(1, 0.239216, 0.243137, 1)

[node name="VelocityLine" type="Line2D" parent="TargetActor"]
points = PackedVector2Array(3, -76, 126, -67)
width = 2.0
default_color = Color(0.313726, 0.341176, 1, 1)

[node name="TargetLine" type="Line2D" parent="TargetActor"]
points = PackedVector2Array(13, -118, 129, -106)
width = 2.0
default_color = Color(0.270588, 0.854902, 0.298039, 1)

[node name="SeekingBrakeActor" type="RigidBody2D" parent="."]
process_mode = 4
visible = false
collision_layer = 0
script = SubResource("GDScript_r5t52")
linear_control_mode = 3

[node name="Interpolator" type="Node2D" parent="SeekingBrakeActor"]
script = ExtResource("1_q6mkr")

[node name="Sprite2D" type="Sprite2D" parent="SeekingBrakeActor/Interpolator"]
scale = Vector2(0.25, 0.25)
texture = ExtResource("2_1x0lk")

[node name="RemoteTransform2D" type="RemoteTransform2D" parent="SeekingBrakeActor/Interpolator"]
remote_path = NodePath("../../../Camera2D")
update_rotation = false
update_scale = false

[node name="CollisionShape2D" type="CollisionShape2D" parent="SeekingBrakeActor"]
shape = SubResource("RectangleShape2D_njbur")

[node name="ThrustLine" type="Line2D" parent="SeekingBrakeActor"]
points = PackedVector2Array(-3, -32, 125, -30)
width = 2.0
default_color = Color(1, 0.239216, 0.243137, 1)

[node name="VelocityLine" type="Line2D" parent="SeekingBrakeActor"]
points = PackedVector2Array(3, -76, 126, -67)
width = 2.0
default_color = Color(0.313726, 0.341176, 1, 1)

[node name="TargetLine" type="Line2D" parent="SeekingBrakeActor"]
points = PackedVector2Array(13, -118, 129, -106)
width = 2.0
default_color = Color(0.270588, 0.854902, 0.298039, 1)

[node name="SeekingNoBrakeActor" type="RigidBody2D" parent="."]
process_mode = 4
visible = false
collision_layer = 0
script = SubResource("GDScript_r5t52")
linear_control_mode = 3
linear_brake = 0.0

[node name="Interpolator" type="Node2D" parent="SeekingNoBrakeActor"]
script = ExtResource("1_q6mkr")

[node name="Sprite2D" type="Sprite2D" parent="SeekingNoBrakeActor/Interpolator"]
scale = Vector2(0.25, 0.25)
texture = ExtResource("2_1x0lk")

[node name="RemoteTransform2D" type="RemoteTransform2D" parent="SeekingNoBrakeActor/Interpolator"]
remote_path = NodePath("../../../Camera2D")
update_rotation = false
update_scale = false

[node name="CollisionShape2D" type="CollisionShape2D" parent="SeekingNoBrakeActor"]
shape = SubResource("RectangleShape2D_njbur")

[node name="ThrustLine" type="Line2D" parent="SeekingNoBrakeActor"]
points = PackedVector2Array(-3, -32, 125, -30)
width = 2.0
default_color = Color(1, 0.239216, 0.243137, 1)

[node name="VelocityLine" type="Line2D" parent="SeekingNoBrakeActor"]
points = PackedVector2Array(3, -76, 126, -67)
width = 2.0
default_color = Color(0.313726, 0.341176, 1, 1)

[node name="TargetLine" type="Line2D" parent="SeekingNoBrakeActor"]
points = PackedVector2Array(13, -118, 129, -106)
width = 2.0
default_color = Color(0.270588, 0.854902, 0.298039, 1)

[node name="Camera2D" type="Camera2D" parent="."]

[node name="StaticBody2D" type="StaticBody2D" parent="."]
position = Vector2(214, 185)

[node name="CollisionShape2D" type="CollisionShape2D" parent="StaticBody2D"]
shape = SubResource("CircleShape2D_1fkjg")

[node name="Sprite2D" type="Sprite2D" parent="StaticBody2D"]
texture = SubResource("GradientTexture2D_4ct4i")

[node name="StaticBody2D2" type="StaticBody2D" parent="."]
position = Vector2(-308, -307)

[node name="CollisionShape2D" type="CollisionShape2D" parent="StaticBody2D2"]
shape = SubResource("CircleShape2D_vsry6")

[node name="Sprite2D" type="Sprite2D" parent="StaticBody2D2"]
scale = Vector2(2, 2)
texture = SubResource("GradientTexture2D_4ct4i")

[node name="SubBodyActor" type="RigidBody2D" parent="."]
collision_layer = 0
script = SubResource("GDScript_pu3on")
max_linear_thrust = 512.0

[node name="Interpolator" type="Node2D" parent="SubBodyActor"]
script = ExtResource("1_q6mkr")

[node name="Sprite2D" type="Sprite2D" parent="SubBodyActor/Interpolator"]
scale = Vector2(0.25, 0.25)
texture = ExtResource("2_1x0lk")

[node name="RemoteTransform2D" type="RemoteTransform2D" parent="SubBodyActor/Interpolator"]
remote_path = NodePath("../../../Camera2D")

[node name="CollisionShape2D" type="CollisionShape2D" parent="SubBodyActor"]
shape = SubResource("RectangleShape2D_njbur")

[node name="ThrustLine" type="Line2D" parent="SubBodyActor"]
points = PackedVector2Array(-3, -32, 125, -30)
width = 2.0
default_color = Color(1, 0.239216, 0.243137, 1)

[node name="VelocityLine" type="Line2D" parent="SubBodyActor"]
points = PackedVector2Array(3, -76, 126, -67)
width = 2.0
default_color = Color(0.313726, 0.341176, 1, 1)

[node name="TargetLine" type="Line2D" parent="SubBodyActor"]
points = PackedVector2Array(13, -118, 129, -106)
width = 2.0
default_color = Color(0.270588, 0.854902, 0.298039, 1)

[node name="SubBodyA" type="Marker2D" parent="SubBodyActor"]
position = Vector2(64, 0)

[node name="ActorSubBody" type="RigidBody2D" parent="SubBodyActor/SubBodyA" node_paths=PackedStringArray("parent_actor", "target_marker")]
collision_layer = 0
script = SubResource("GDScript_qu3b8")
parent_actor = NodePath("../..")
target_marker = NodePath("..")

[node name="CollisionShape2D" type="CollisionShape2D" parent="SubBodyActor/SubBodyA/ActorSubBody"]
shape = SubResource("RectangleShape2D_t7hum")

[node name="Interpolator" type="Node2D" parent="SubBodyActor/SubBodyA/ActorSubBody"]
script = ExtResource("1_q6mkr")

[node name="Sprite2D" type="Sprite2D" parent="SubBodyActor/SubBodyA/ActorSubBody/Interpolator"]
scale = Vector2(0.125, 0.125)
texture = ExtResource("2_1x0lk")

[node name="ThrustLine" type="Line2D" parent="SubBodyActor/SubBodyA/ActorSubBody"]
points = PackedVector2Array(-3, -32, 125, -30)
width = 2.0
default_color = Color(1, 0.239216, 0.243137, 1)

[node name="VelocityLine" type="Line2D" parent="SubBodyActor/SubBodyA/ActorSubBody"]
points = PackedVector2Array(3, -76, 126, -67)
width = 2.0
default_color = Color(0.313726, 0.341176, 1, 1)

[node name="TargetLine" type="Line2D" parent="SubBodyActor/SubBodyA/ActorSubBody"]
points = PackedVector2Array(13, -118, 129, -106)
width = 2.0
default_color = Color(0.270588, 0.854902, 0.298039, 1)

[node name="SubBodyB" type="Marker2D" parent="SubBodyActor"]
position = Vector2(-64, 0)

[node name="ActorSubBody" type="RigidBody2D" parent="SubBodyActor/SubBodyB" node_paths=PackedStringArray("parent_actor", "target_marker")]
collision_layer = 0
script = SubResource("GDScript_qu3b8")
parent_actor = NodePath("../..")
target_marker = NodePath("..")

[node name="CollisionShape2D" type="CollisionShape2D" parent="SubBodyActor/SubBodyB/ActorSubBody"]
shape = SubResource("RectangleShape2D_y8lin")

[node name="Interpolator" type="Node2D" parent="SubBodyActor/SubBodyB/ActorSubBody"]
script = ExtResource("1_q6mkr")

[node name="Sprite2D" type="Sprite2D" parent="SubBodyActor/SubBodyB/ActorSubBody/Interpolator"]
scale = Vector2(0.125, 0.125)
texture = ExtResource("2_1x0lk")

[node name="ThrustLine" type="Line2D" parent="SubBodyActor/SubBodyB/ActorSubBody"]
points = PackedVector2Array(-3, -32, 125, -30)
width = 2.0
default_color = Color(1, 0.239216, 0.243137, 1)

[node name="VelocityLine" type="Line2D" parent="SubBodyActor/SubBodyB/ActorSubBody"]
points = PackedVector2Array(3, -76, 126, -67)
width = 2.0
default_color = Color(0.313726, 0.341176, 1, 1)

[node name="TargetLine" type="Line2D" parent="SubBodyActor/SubBodyB/ActorSubBody"]
points = PackedVector2Array(13, -118, 129, -106)
width = 2.0
default_color = Color(0.270588, 0.854902, 0.298039, 1)

[node name="StaticBody2D3" type="StaticBody2D" parent="."]

[node name="CollisionPolygon2D" type="CollisionPolygon2D" parent="StaticBody2D3"]
polygon = PackedVector2Array(-296, -52, -408, 420, -296, 420)

[node name="Polygon2D" type="Polygon2D" parent="StaticBody2D3"]
polygon = PackedVector2Array(-296, -52, -408, 420, -296, 420)
